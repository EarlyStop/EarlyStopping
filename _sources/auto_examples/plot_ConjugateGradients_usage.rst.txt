
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_ConjugateGradients_usage.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_plot_ConjugateGradients_usage.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_ConjugateGradients_usage.py:


Usage of the ConjugateGradients class
======================================

We illustrate the usage and available methods of the ConjugateGradients class via a
small example.

.. GENERATED FROM PYTHON SOURCE LINES 8-19

.. code-block:: Python


    import numpy as np
    import matplotlib.pyplot as plt
    from scipy.sparse import dia_matrix
    import seaborn as sns
    import EarlyStopping as es

    np.random.seed(42)
    sns.set_theme()









.. GENERATED FROM PYTHON SOURCE LINES 20-23

Generating synthetic data
-------------------------
To simulate some data we consider the signals from `Blanchard, Hoffmann and Rei√ü (2018) <https://projecteuclid.org/journals/electronic-journal-of-statistics/volume-12/issue-2/Early-stopping-for-statistical-inverse-problems-via-truncated-SVD-estimation/10.1214/18-EJS1482.full>`_.

.. GENERATED FROM PYTHON SOURCE LINES 23-42

.. code-block:: Python

    sample_size = 10000
    indices = np.arange(sample_size) + 1

    signal_supersmooth = 5 * np.exp(-0.1 * indices)
    signal_smooth = 5000 * np.abs(np.sin(0.01 * indices)) * indices ** (-1.6)
    signal_rough = 250 * np.abs(np.sin(0.002 * indices)) * indices ** (-0.8)

    true_signal = signal_rough

    plt.figure(figsize=(14, 4))
    plt.plot(indices, signal_supersmooth, label="supersmooth signal")
    plt.plot(indices, signal_smooth, label="smooth signal")
    plt.plot(indices, signal_rough, label="rough signal")
    plt.ylabel("Signal")
    plt.xlabel("Index")
    plt.ylim([0, 0.4])
    plt.legend(loc="upper right")
    plt.show()




.. image-sg:: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_001.png
   :alt: plot ConjugateGradients usage
   :srcset: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 43-44

We simulate data from a prototypical inverse problem based on one of the signals.

.. GENERATED FROM PYTHON SOURCE LINES 44-63

.. code-block:: Python

    true_noise_level = 0.01
    noise = true_noise_level * np.random.normal(0, 1, sample_size)

    eigenvalues = 1 / np.sqrt(indices)
    design = dia_matrix(np.diag(eigenvalues))

    response = eigenvalues * true_signal + noise

    # Initialize ConjugateGradients class
    alg = es.ConjugateGradients(
        design,
        response,
        initial_value=None,
        true_signal=true_signal,
        true_noise_level=true_noise_level,
        computation_threshold=10 ** (-8),
    )
    alg.iterate(sample_size)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    UserWarning: No initial_value is given, using zero by default.
    UserWarning: Algorithm terminates at iteration 128: norm of transformed residual vector (9.779623811691058e-09) <= computation_threshold (1e-08).




.. GENERATED FROM PYTHON SOURCE LINES 64-65

Empirical risk (weak/strong)

.. GENERATED FROM PYTHON SOURCE LINES 65-78

.. code-block:: Python

    plt.figure()
    plt.plot(indices[0 : alg.iteration + 1], alg.weak_empirical_risk, label="Weak empirical risk")
    plt.legend(loc="upper right")
    plt.show()

    plt.figure()
    plt.plot(indices[0 : alg.iteration + 1], alg.strong_empirical_risk, label="Strong empirical risk")
    plt.legend(loc="upper right")
    plt.show()

    print(f"Weak empirical oracle: {alg.get_weak_empirical_oracle(sample_size)}")
    print(f"Strong empirical oracle: {alg.get_strong_empirical_oracle(sample_size)}")




.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_002.png
         :alt: plot ConjugateGradients usage
         :srcset: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_003.png
         :alt: plot ConjugateGradients usage
         :srcset: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_003.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    UserWarning: Algorithm terminated due to computation_threshold before max_iteration. max_iteration is set to terminal iteration index.
    Weak empirical oracle: 20
    UserWarning: Algorithm terminated due to computation_threshold before max_iteration. max_iteration is set to terminal iteration index.
    Strong empirical oracle: 17




.. GENERATED FROM PYTHON SOURCE LINES 79-80

Early stopping w/ discrepancy principle

.. GENERATED FROM PYTHON SOURCE LINES 80-94

.. code-block:: Python

    critical_value = sample_size * true_noise_level**2
    discrepancy_time = alg.get_discrepancy_stop(critical_value, sample_size)

    estimated_signal = alg.get_estimate(discrepancy_time)

    print(f"Critical value: {critical_value}.")
    print(f"Discrepancy stopping time: {discrepancy_time}")

    plt.figure(figsize=(14, 4))
    plt.plot(indices, estimated_signal, label="Estimated signal at stopping time")
    plt.plot(indices, true_signal, label="True signal")
    plt.ylim([0, 2])
    plt.legend(loc="upper right")
    plt.show()



.. image-sg:: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_004.png
   :alt: plot ConjugateGradients usage
   :srcset: /auto_examples/images/sphx_glr_plot_ConjugateGradients_usage_004.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Critical value: 1.0.
    Discrepancy stopping time: 15





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.810 seconds)


.. _sphx_glr_download_auto_examples_plot_ConjugateGradients_usage.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_ConjugateGradients_usage.ipynb <plot_ConjugateGradients_usage.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_ConjugateGradients_usage.py <plot_ConjugateGradients_usage.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_ConjugateGradients_usage.zip <plot_ConjugateGradients_usage.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
